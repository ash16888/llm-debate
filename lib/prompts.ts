import { RoleType, RolePrompt } from '@/types/debate';

export const ROLE_PROMPTS: Record<RoleType, RolePrompt> = {
  proponent: {
    name: "Сторонник",
    systemPrompt: `Ты участвуешь в дебатах как СТОРОННИК утверждения, представленного в теме. 
    
КРИТИЧЕСКИ ВАЖНО: 
- Ты ПОДДЕРЖИВАЕШЬ и ЗАЩИЩАЕШЬ тезис, заявленный в теме дебатов
- Если тема утверждает что-то негативное - ты доказываешь, что это правда
- Если тема утверждает что-то позитивное - ты доказываешь, что это правда
- Твои ответы должны быть не более 3 предложений!

Каждый ответ - это 1-3 мощных аргумента В ПОДДЕРЖКУ темы дебатов.`,
    description: "защитник тезиса, который развивает и обосновывает основную идею"
  },
  
  critic: {
    name: "Критик",
    systemPrompt: `Ты участвуешь в дебатах как КРИТИК утверждения, представленного в теме.
    
КРИТИЧЕСКИ ВАЖНО:
- Ты ОСПАРИВАЕШЬ и ОПРОВЕРГАЕШЬ тезис, заявленный в теме дебатов
- Если тема утверждает что-то негативное - ты доказываешь, что это неправда или преувеличение
- Если тема утверждает что-то позитивное - ты находишь слабые стороны и опровергаешь
- Твои ответы должны быть не более 3 предложений!

Каждый ответ - это 1-3 точных контраргумента ПРОТИВ темы дебатов.`,
    description: "критический мыслитель, который проверяет идеи на прочность"
  }
};

export function generateRoundPrompt(
  topic: string,
  round: number,
  totalRounds: number,
  previousMessages: string[],
  _role: RoleType
): string {
  const isFirstRound = round === 1;
  const isLastRound = round === totalRounds;
  
  let prompt = `Тема дебатов: "${topic}"\n`;
  prompt += `Раунд ${round} из ${totalRounds}\n\n`;
  
  if (isFirstRound) {
    prompt += `Это первый раунд дебатов. Представь свою позицию по теме.\n`;
    prompt += `Изложи свои основные аргументы ясно и структурированно.\n`;
  } else {
    prompt += `Предыдущие аргументы в дебатах:\n`;
    prompt += `${previousMessages.join('\n\n---\n\n')}\n\n`;
    
    if (isLastRound) {
      prompt += `Это заключительный раунд. Подведи итоги дискуссии.\n`;
      prompt += `Сделай сильное заключительное заявление, обобщив свою позицию.\n`;
    } else {
      prompt += `Развивай свою аргументацию, отвечая на доводы оппонента.\n`;
      prompt += `Укрепляй свою позицию новыми аргументами и примерами.\n`;
    }
  }
  
  prompt += `\nОГРАНИЧЕНИЕ: Твой ответ должен быть не более 3 предложений! Каждое предложение должно быть емким и сильным.`;
  
  return prompt;
}

// Функция для форматирования истории сообщений
export function formatMessageHistory(messages: Array<{
  model: string;
  role: string;
  content: string;
  round: number;
}>): string[] {
  return messages.map((msg) => {
    const roleLabel = ROLE_PROMPTS[msg.role as RoleType]?.name || msg.role;
    return `${roleLabel} (${msg.model}, Раунд ${msg.round}):\n${msg.content}`;
  });
}

// Примеры тем для дебатов
export const DEBATE_TOPICS_EXAMPLES = [
  "Искусственный интеллект заменит большинство человеческих профессий в ближайшие 20 лет",
  "Социальные сети приносят больше вреда, чем пользы современному обществу",
  "Базовый безусловный доход - необходимость для будущего экономики",
  "Освоение космоса должно быть приоритетом человечества",
  "Генетическая модификация человека этически оправдана",
  "Криптовалюты заменят традиционные деньги",
  "Удаленная работа эффективнее офисной",
  "Университетское образование устарело в эпоху интернета"
];